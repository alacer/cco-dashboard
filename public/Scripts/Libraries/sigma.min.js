/* sigmajs.org - an open-source light-weight JavaScript graph drawing library - Version: 0.1 - Author:  Alexis Jacomy - License: MIT */
var sigma={tools:{},classes:{},instances:{}};
(function(){Array.prototype.some||(Array.prototype.some=function(p,v){var k=this.length;if("function"!=typeof p)throw new TypeError;for(var n=0;n<k;n++)if(n in this&&p.call(v,this[n],n,this))return!0;return!1});Array.prototype.forEach||(Array.prototype.forEach=function(p,v){var k=this.length;if("function"!=typeof p)throw new TypeError;for(var n=0;n<k;n++)n in this&&p.call(v,this[n],n,this)});Array.prototype.map||(Array.prototype.map=function(p,v){var k=this.length;if("function"!=typeof p)throw new TypeError;
for(var n=Array(k),s=0;s<k;s++)s in this&&(n[s]=p.call(v,this[s],s,this));return n});Array.prototype.filter||(Array.prototype.filter=function(p,v){var k=this.length;if("function"!=typeof p)throw new TypeError;for(var n=[],s=0;s<k;s++)if(s in this){var B=this[s];p.call(v,B,s,this)&&n.push(B)}return n});Object.keys||(Object.keys=function(){var p=Object.prototype.hasOwnProperty,v=!{toString:null}.propertyIsEnumerable("toString"),k="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),
n=k.length;return function(s){if("object"!==typeof s&&"function"!==typeof s||null===s)throw new TypeError("Object.keys called on non-object");var B=[],y;for(y in s)p.call(s,y)&&B.push(y);if(v)for(y=0;y<n;y++)p.call(s,k[y])&&B.push(k[y]);return B}}())})();sigma.classes.Cascade=function(){this.p={};this.config=function(p,v){if("string"==typeof p&&void 0==v)return this.p[p];var k="object"==typeof p&&void 0==v?p:{};"string"==typeof p&&(k[p]=v);for(var n in k)void 0!=this.p[n]&&(this.p[n]=k[n]);return this}};
sigma.classes.EventDispatcher=function(){var p={},v=this;this.one=function(k,n){if(!n||!k)return v;("string"==typeof k?k.split(" "):k).forEach(function(k){p[k]||(p[k]=[]);p[k].push({h:n,one:!0})});return v};this.bind=function(k,n){if(!n||!k)return v;("string"==typeof k?k.split(" "):k).forEach(function(k){p[k]||(p[k]=[]);p[k].push({h:n,one:!1})});return v};this.unbind=function(k,n){k||(p={});var s="string"==typeof k?k.split(" "):k;n?s.forEach(function(k){p[k]&&(p[k]=p[k].filter(function(k){return k.h!=
n}));p[k]&&0==p[k].length&&delete p[k]}):s.forEach(function(k){delete p[k]});return v};this.dispatch=function(k,n){p[k]&&(p[k].forEach(function(p){p.h({type:k,content:n,target:v})}),p[k]=p[k].filter(function(k){return!k.one}));return v}};
(function(){function p(){function b(d){return{x:d.x,y:d.y,size:d.size,degree:d.degree,inDegree:d.inDegree,outDegree:d.outDegree,displayX:d.displayX,displayY:d.displayY,displaySize:d.displaySize,label:d.label,id:d.id,color:d.color,fixed:d.fixed,active:d.active,hidden:d.hidden,forceLabel:d.forceLabel,attr:d.attr}}function h(d){return{source:d.source.id,target:d.target.id,size:d.size,type:d.type,weight:d.weight,displaySize:d.displaySize,label:d.label,hidden:d.hidden,id:d.id,attr:d.attr,color:d.color}}
function f(){d.nodes=[];d.nodesIndex={};d.edges=[];d.edgesIndex={};return d}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var d=this;this.p={minNodeSize:0,maxNodeSize:0,minEdgeSize:0,maxEdgeSize:0,scalingMode:"inside",nodesPowRatio:0.5,edgesPowRatio:0,arrowRatio:3,safe:!0};this.borders={};f();this.addNode=function(b,c){if(d.nodesIndex[b])throw Error('Node "'+b+'" already exists.');c=c||{};var a={x:0,y:0,size:1,degree:0,inDegree:0,outDegree:0,fixed:!1,active:!1,hidden:!1,
forceLabel:!1,label:b.toString(),id:b.toString(),attr:{}},f;for(f in c)switch(f){case "id":break;case "x":case "y":case "size":a[f]=+c[f];break;case "fixed":case "active":case "hidden":case "forceLabel":a[f]=!!c[f];break;case "color":case "label":case "image":case "shape":case "glyph":a[f]=c[f];break;case "attributes":for(var r in c[f])void 0!=c[f][r].attr&&void 0!=c[f][r].val&&(a.attr[c[f][r].attr]=c[f][r].val);break;default:void 0!=c[f]&&(a.attr[f]=c[f])}d.nodes.push(a);d.nodesIndex[b.toString()]=
a;return d};this.addEdge=function(b,c,a,f){if(d.edgesIndex[b])throw Error('Edge "'+b+'" already exists.');if(!d.nodesIndex[c])throw Error("Edge's source \""+c+'" does not exist yet.');if(!d.nodesIndex[a])throw Error("Edge's target \""+a+'" does not exist yet.');f=f||{};c={source:d.nodesIndex[c],target:d.nodesIndex[a],size:1,weight:1,displaySize:0.5,label:b.toString(),id:b.toString(),hidden:!1,attr:{}};c.source.degree++;c.source.outDegree++;c.target.degree++;c.target.inDegree++;for(var r in f)switch(r){case "id":case "source":case "target":break;
case "hidden":c[r]=!!f[r];break;case "size":case "weight":c[r]=+f[r];break;case "color":c[r]=f[r].toString();break;case "type":c[r]=f[r].toString();break;case "label":c[r]=f[r];break;case "attributes":for(var h in f[r])void 0!=f[r][h].attr&&void 0!=f[r][h].val&&(c.attr[f[r][h].attr]=f[r][h].val);break;default:void 0!=f[r]&&(c.attr[r]=f[r])}d.edges.push(c);d.edgesIndex[b.toString()]=c;return d};this.dropNode=function(b){var c=(b instanceof Array?b:[b])||[];c.forEach(function(a){if(d.nodesIndex[a]){var c=
null;d.nodes.some(function(d,b){return d.id==a?(c=b,!0):!1});null!=c&&d.nodes.splice(c,1);delete d.nodesIndex[a]}else sigma.log('Node "'+a+'" does not exist.')});d.edges=d.edges.filter(function(a){return-1!=c.indexOf(a.source.id)?(delete d.edgesIndex[a.id],a.target.degree--,a.target.inDegree--,!1):-1!=c.indexOf(a.target.id)?(delete d.edgesIndex[a.id],a.source.degree--,a.source.outDegree--,!1):!0});return d};this.dropEdge=function(b){((b instanceof Array?b:[b])||[]).forEach(function(c){if(d.edgesIndex[c]){d.edgesIndex[c].source.degree--;
d.edgesIndex[c].source.outDegree--;d.edgesIndex[c].target.degree--;d.edgesIndex[c].target.inDegree--;var a=null;d.edges.some(function(d,b){return d.id==c?(a=b,!0):!1});null!=a&&d.edges.splice(a,1);delete d.edgesIndex[c]}else sigma.log('Edge "'+c+'" does not exist.')});return d};this.iterEdges=function(b,c){var a=c?c.map(function(a){return d.edgesIndex[a]}):d.edges;if(d.p.safe){var f=a.map(h);f.forEach(b);a.forEach(function(a,c){var b=f[c],l;for(l in b)switch(l){case "id":case "displaySize":break;
case "weight":case "size":a[l]=+b[l];break;case "source":case "target":a[l]=d.nodesIndex[l]||a[l];break;case "hidden":a[l]=!!b[l];break;case "color":case "label":case "type":a[l]=(b[l]||"").toString();break;default:a[l]=b[l]}})}else a.forEach(b);return d};this.iterNodes=function(f,c){var a=c?c.map(function(a){return d.nodesIndex[a]}):d.nodes;if(d.p.safe){var h=a.map(b);h.forEach(f);a.forEach(function(a,d){var c=h[d],b;for(b in c)switch(b){case "id":case "attr":case "degree":case "inDegree":case "outDegree":case "displayX":case "displayY":case "displaySize":break;
case "x":case "y":case "size":a[b]=+c[b];break;case "fixed":case "active":case "hidden":case "forceLabel":a[b]=!!c[b];break;case "color":case "label":a[b]=(c[b]||"").toString();break;default:a[b]=c[b]}})}else a.forEach(f);return d};this.getEdges=function(b){var c=(b instanceof Array?b:[b])||[];d.p.safe?c.map(function(a){return h(d.edgesIndex[a])}):c.map(function(a){return d.edgesIndex[a]});return b instanceof Array?c:c[0]};this.getNodes=function(f){var c=(f instanceof Array?f:[f])||[],c=d.p.safe?
c.map(function(a){return b(d.nodesIndex[a])}):c.map(function(a){return d.nodesIndex[a]});return f instanceof Array?c:c[0]};this.empty=f;this.rescale=function(b,c,a,f){var h=0,k=0;a&&d.nodes.forEach(function(a){k=Math.max(a.size,k)});f&&d.edges.forEach(function(a){h=Math.max(a.size,h)});var k=k||1,h=h||1,u,m;d.p.maxNodeSize||d.p.minNodeSize?d.p.maxNodeSize==d.p.minNodeSize?(u=0,m=d.p.maxNodeSize):(u=(d.p.maxNodeSize-d.p.minNodeSize)/k,m=d.p.minNodeSize):(u=1,m=0);var q,p;d.p.maxEdgeSize||d.p.minEdgeSize?
(q=d.p.maxEdgeSize==d.p.minEdgeSize?0:(d.p.maxEdgeSize-d.p.minEdgeSize)/h,p=d.p.minEdgeSize):(q=1,p=0);a&&d.nodes.forEach(function(a){a.displaySize=Math.sqrt((a.size*u+m)/Math.PI);a.fixed||(a.displayX=a.x,a.displayY=a.y)});f&&d.edges.forEach(function(a){a.displaySize=a.size*q+p});return d};this.translate=function(b,c,a,f,h){var k=Math.pow(a,d.p.nodesPowRatio);f&&d.nodes.forEach(function(d){d.fixed||(d.displayX=d.displayX*a+b,d.displayY=d.displayY*a+c);d.displaySize*=k});h&&d.edges.forEach(function(c){c.displaySize*=
Math.pow(a,d.p.edgesPowRatio);c.arrowDisplaySize=c.displaySize*d.p.arrowRatio});return d};this.translateNodes=function(b,c,a,f,h,k){b.forEach(function(b){b=d.nodesIndex[b];b.x=(b.displayX-f+c)/k;b.y=(b.displayY-h+a)/k});return d};this.setBorders=function(){d.borders={};d.nodes.forEach(function(b){d.borders.minX=Math.min(void 0==d.borders.minX?b.displayX-b.displaySize:d.borders.minX,b.displayX-b.displaySize);d.borders.maxX=Math.max(void 0==d.borders.maxX?b.displayX+b.displaySize:d.borders.maxX,b.displayX+
b.displaySize);d.borders.minY=Math.min(void 0==d.borders.minY?b.displayY-b.displaySize:d.borders.minY,b.displayY-b.displaySize);d.borders.maxY=Math.max(void 0==d.borders.maxY?b.displayY-b.displaySize:d.borders.maxY,b.displayY-b.displaySize)})};this.checkHover=function(b,c){var a,f,h,k=[],u=[];d.nodes.forEach(function(d){if(d.hidden)d.hover=!1;else{a=Math.abs(d.displayX-b);f=Math.abs(d.displayY-c);h=d.displaySize;var q=d.hover,p=a<h&&f<h&&Math.sqrt(a*a+f*f)<h;q&&!p?(d.hover=!1,u.push(d.id)):p&&!q&&
(d.hover=!0,k.push(d.id))}});k.length&&d.dispatch("overnodes",k);u.length&&d.dispatch("outnodes",u);return d};this.checkHoverEdge=function(b,c,a,f){var h,k,p,m,q,n,z,x,E,g,s,v,t,A=!1,C=[],D=[],G=8*Math.abs(Math.log(1/(a*a)))||100;d.edges.forEach(function(a){if(a.hidden)a.hover=!1;else{q=a.source.displayX;n=a.source.displayY;E=a.source.displaySize;z=a.target.displayX;x=a.target.displayY;g=a.target.displaySize;s=a.displaySize;v=a.hover;t=!1;h=Math.abs(q-b);k=Math.abs(n-c);p=Math.abs(z-b);m=Math.abs(x-
c);if(!(q==z&&n==x||h<E&&k<E||p<g&&m<g))switch(f){case "curve":t=sigma.tools.isOnQuadraticCurve(b,c,q,n,z,x,(q+z)/2+(x-n)/4,(n+x)/2+(q-z)/4,s,G);break;default:t=sigma.tools.isOnSegment(b,c,q,n,z,x,s,G)}!A&&t?(A=!0,C.push(a.id),a.hover=t):t||(a.hover=t);v&&!t&&D.push(a.id)}});C.length&&d.dispatch("overedges",C);D.length&&d.dispatch("outedges",D);return d}}function v(b,h){function f(){var b;b="<p>GLOBAL :</p>";for(var c in d.p.globalProbes)b+="<p>"+c+" : "+d.p.globalProbes[c]()+"</p>";b+="<br><p>LOCAL :</p>";
for(c in d.p.localProbes)b+="<p>"+c+" : "+d.p.localProbes[c]()+"</p>";d.p.dom.innerHTML=b;return d}sigma.classes.Cascade.call(this);var d=this;this.instance=b;this.monitoring=!1;this.p={fps:40,dom:h,globalProbes:{"Time (ms)":sigma.chronos.getExecutionTime,Queue:sigma.chronos.getQueuedTasksCount,Tasks:sigma.chronos.getTasksCount,FPS:sigma.chronos.getFPS},localProbes:{"Nodes count":function(){return d.instance.graph.nodes.length},"Edges count":function(){return d.instance.graph.edges.length}}};this.activate=
function(){d.monitoring||(d.monitoring=window.setInterval(f,1E3/d.p.fps));return d};this.desactivate=function(){d.monitoring&&(window.clearInterval(d.monitoring),d.monitoring=null,d.p.dom.innerHTML="");return d}}function k(b){function h(a){c.p.mouseEnabled&&(d(c.mouseX,c.mouseY,c.ratio*(0<(void 0!=a.wheelDelta&&a.wheelDelta||void 0!=a.detail&&-a.detail)?c.p.zoomMultiply:1/c.p.zoomMultiply)),c.p.blockScroll&&(a.preventDefault?a.preventDefault():a.returnValue=!1))}function f(){r=c.stageX;p=c.stageY;
c.startX=c.mouseX;c.startY=c.mouseY;z=n=c.stageX;E=x=c.stageY;c.dispatch("startdrag")}function d(a,b,d){c.isMouseDown||(window.clearInterval(c.interpolationID),s=void 0!=d,r=c.stageX,m=a,p=c.stageY,q=b,u=d||c.ratio,u=Math.min(Math.max(u,c.p.minRatio),c.p.maxRatio),g=c.p.directZooming?1-(s?c.p.zoomDelta:c.p.dragDelta):0,c.ratio==u&&c.stageX==m&&c.stageY==q)||(l(),c.interpolationID=window.setInterval(l,50),c.dispatch("startinterpolate"))}function l(){g+=s?c.p.zoomDelta:c.p.dragDelta;g=Math.min(g,1);
var a=sigma.easing.quadratic.easeout(g),b=c.ratio;c.ratio=b*(1-a)+u*a;s?(c.stageX=m+(c.stageX-m)*c.ratio/b,c.stageY=q+(c.stageY-q)*c.ratio/b):(c.stageX=r*(1-a)+m*a,c.stageY=p*(1-a)+q*a);c.dispatch("interpolate");1<=g&&(window.clearInterval(c.interpolationID),a=c.ratio,s?(c.ratio=u,c.stageX=m+(c.stageX-m)*c.ratio/a,c.stageY=q+(c.stageY-q)*c.ratio/a):(c.stageX=m,c.stageY=q),c.dispatch("stopinterpolate"))}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var c=this;this.p={minRatio:1,
maxRatio:32,marginRatio:1,zoomDelta:0.1,dragDelta:0.3,zoomMultiply:2,directZooming:!1,blockScroll:!0,inertia:1.1,mouseEnabled:!0};var a=0,k=0;c.startX=0;var r=c.startY=0,p=0,u=1,m=0,q=0,n=0,z=0,x=0,E=0,g=0,s=!1,v=Date.now();this.stageY=this.stageX=0;this.ratio=1;this.mouseY=this.mouseX=0;this.isMouseDown=!1;b.addEventListener("DOMMouseScroll",h,!0);b.addEventListener("mousewheel",h,!0);b.addEventListener("mousemove",function(t){a=c.mouseX;k=c.mouseY;c.mouseX=void 0!=t.offsetX&&t.offsetX||void 0!=
t.layerX&&t.layerX||void 0!=t.clientX&&t.clientX;c.mouseY=void 0!=t.offsetY&&t.offsetY||void 0!=t.layerY&&t.layerY||void 0!=t.clientY&&t.clientY;c.dispatch("move",{dX:c.mouseX-a,dY:c.mouseY-k,stageX:c.stageX,stageY:c.stageY,ratio:c.ratio});t.preventDefault?t.preventDefault():t.returnValue=!1},!0);b.addEventListener("mousedown",function(t){if(c.p.mouseEnabled){var b=Date.now();400>b-v?c.dispatch("dblclick"):v=b;if(t.ctrlKey||t.metaKey)c.dispatch("ctrlclick");else switch(t.which){case 1:c.isMouseDown=
!0;a=c.mouseX;k=c.mouseY;c.dispatch("mousedown");f();break;case 2:c.dispatch("rightclick");break;case 3:c.dispatch("rightclick");break;default:c.isMouseDown=!0,a=c.mouseX,k=c.mouseY,c.dispatch("mousedown"),f()}t.preventDefault?t.preventDefault():t.returnValue=!1}},!0);document.addEventListener("mouseup",function(a){if(c.p.mouseEnabled&&c.isMouseDown){c.isMouseDown=!1;c.dispatch("mouseup");if(r!=c.stageX||p!=c.stageY)d(c.stageX+c.p.inertia*(c.stageX-z),c.stageY+c.p.inertia*(c.stageY-E)),c.dispatch("stopdrag");
a.preventDefault?a.preventDefault():a.returnValue=!1}},!0);this.checkBorders=function(a,b,d){return c};this.interpolate=d;this.drag=function(){var a=c.mouseX-c.startX+r,b=c.mouseY-c.startY+p;if(a!=c.stageX||b!=c.stageY)z=n,E=x,n=a,x=b,c.stageX=a,c.stageY=b,c.dispatch("drag")}}function n(b,h,f,d,l,c,a,k,p){function n(a,b,d,c,g,f){a.fillStyle=b;a.beginPath();a.arc(d,c,g,0,2*Math.PI,!0);a.closePath();a.fill()}function u(a,b,d,c,f){var h=f.text.length;c*=4>h?2-0.25*h:1;c>=1.3*g.p.labelThreshold&&(a.save(),
a.font=g.p.fontStyle+" "+c+"px "+g.p.font,a.fillStyle=f.fontColor||g.p.defaultGlyphFontColor,a.textAlign="center",a.fillText("function"===typeof f.text?f.text():f.text,b,d+0.4*c),a.restore());return g}function m(a){var b=l,d="fixed"==g.p.labelSize?g.p.defaultLabelSize:g.p.labelSizeRatio*a.displaySize;b.font=(g.p.hoverFontStyle||g.p.fontStyle||"")+" "+d+"px "+(g.p.hoverFont||g.p.font||"");b.fillStyle="node"==g.p.labelHoverBGColor?a.color||g.p.defaultNodeColor:a.bgcolor||g.p.defaultHoverLabelBGColor;
b.beginPath();g.p.labelHoverShadow&&(b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=4,b.shadowColor=g.p.labelHoverShadowColor);textWidth=b.measureText(a.label).width;var c,f,h,m="left";switch(g.p.labelPosition){case "top":h=Math.round(textWidth+1.5*a.displaySize);c=Math.round(a.displayX-h/2);f=Math.round(a.displayY-1.5*a.displaySize-d);m=["left","right"];break;case "bottom":h=Math.round(textWidth+1.5*a.displaySize);c=Math.round(a.displayX-h/2);f=Math.round(a.displayY+1.5*a.displaySize);m=["left",
"right"];break;case "left":c=Math.round(a.displayX-1.5*a.displaySize-textWidth-2);f=Math.round(a.displayY-d/2-2);m="right";h=Math.round(textWidth+1.5*a.displaySize+d/2+4);break;case "center":h=Math.round(textWidth+d/2);c=Math.round(a.displayX-h/2);f=Math.round(a.displayY-d/2);m=["left","right"];break;default:c=Math.round(a.displayX-d/2-2),f=Math.round(a.displayY-d/2-2),h=Math.round(textWidth+1.5*a.displaySize+d/2+4)}sigma.tools.drawRoundRect(b,c,f,h,Math.round(d+4),Math.round(d/2+2),m);b.closePath();
b.fill();b.shadowOffsetX=0;b.shadowOffsetY=0;b.shadowBlur=0;h="node"==g.p.nodeBorderColor?a.color||g.p.defaultNodeColor:g.p.defaultNodeBorderColor;g.drawHoverNodeBorder(b,h,Math.round(a.displayX),Math.round(a.displayY),a.displaySize+g.p.borderSize,a);var k="node"==g.p.nodeHoverColor?a.color||g.p.defaultNodeColor:g.p.defaultNodeHoverColor;g.drawHoverNodeShape(b,k,Math.round(a.displayX),Math.round(a.displayY),a.displaySize,a);if(a.glyph&&"hidden"!==g.p.glyphVisible){m=a.displaySize+g.p.borderSize;c=
"left"===a.glyph.x?a.displayX-m/1.5:a.displayX+m/1.5;f="bottom"===a.glyph.y?a.displayY+m/1.5:a.displayY-m/1.5;var q=m*g.p.defaultGlyphSizeRatio,k="node"===g.p.glyphColor?k:a.glyph.color||g.p.defaultGlyphColor;g.drawHoverNodeGlyphBorder(b,h,c,f,m*(g.p.defaultGlyphSizeRatio+0.1*g.p.defaultGlyphSizeRatio),a.glyph);g.drawHoverNodeGlyph(b,k,c,f,q,a.glyph);h=g.p.labelSizeRatio*a.displaySize*g.p.defaultGlyphFontSizeRatio;a.glyph.text&&u(b,c,f,h,a.glyph)}b.fillStyle="node"==g.p.labelHoverColor?a.color||g.p.defaultNodeColor:
a.fontcolor||g.p.defaultLabelHoverColor;switch(g.p.labelPosition){case "top":c=Math.round(a.displayX-textWidth/2);f=Math.round(a.displayY-1.5*a.displaySize);break;case "bottom":c=Math.round(a.displayX-textWidth/2);f=Math.round(a.displayY+1.5*a.displaySize+d);break;case "left":c=Math.round(a.displayX-1.5*a.displaySize-textWidth);f=Math.round(a.displayY+d/2);break;case "center":c=Math.round(a.displayX-textWidth/2);f=Math.round(a.displayY+d/2);break;default:c=Math.round(a.displayX+1.5*a.displaySize),
f=Math.round(a.displayY+d/2-3)}b.fillText(a.label,c,f);return g}function q(a){if(!e.hidden&&(g.isOnScreen(a.source)||g.isOnScreen(a.target))){var b=[a.source.displayX,a.source.displayY],d=[a.target.displayX,a.target.displayY],f=a.color;switch(g.p.edgeHoverColor){case "source":f=a.source.color||g.p.defaultNodeColor;break;case "target":f=a.target.color||g.p.defaultNodeColor;break;case "edge":f=a.color||g.p.defaultEdgeHoverColor;break;default:f=g.p.defaultEdgeHoverColor}var h=c;switch(a.type||g.p.defaultEdgeType){case "curve":h.strokeStyle=
f;var f=(b[0]+d[0])/2+(d[1]-b[1])/4,m=(b[1]+d[1])/2+(b[0]-d[0])/4;z("source",a.arrow)&&(b=x(h,b,a.source.displaySize,f,m,a.arrowDisplaySize,!0));if(g.p.directed||z("target",a.arrow))d=x(h,d,a.target.displaySize,f,m,a.arrowDisplaySize,!0);var l=E(a,b,d,f,m);h.beginPath();h.moveTo(b[0],b[1]);h.quadraticCurveTo(f,m,d[0],d[1]);h.quadraticCurveTo(l.x,l.y,b[0],b[1]);h.fill();break;default:h.strokeStyle=f;h.lineCap="round";z("source",a.arrow)&&(b=x(h,b,a.source.displaySize,d[0],d[1],a.arrowDisplaySize));
if(g.p.directed||z("target",a.arrow))d=x(h,d,a.target.displaySize,b[0],b[1],a.arrowDisplaySize);h.lineWidth=a.displaySize/3;h.beginPath();h.moveTo(b[0],b[1]);h.lineTo(d[0],d[1]);h.stroke();break}if(a.source!=a.target&&(void 0!=a.label&&a.label.length)&&(b="fixed"==g.p.edgeLabelSize?g.p.defaultEdgeLabelSize:g.p.edgeLabelSizeRatio*a.displaySize,b>=2.3*g.p.edgeLabelThreshold||a.forceLabel)){var d=c,l=a.source.displayX,f=a.source.displayY,k=a.target.displayX,m=a.target.displayY;d.font=(g.p.edgeHoverFontStyle||
g.p.edgeFontStyle)+" "+b+"px "+(g.p.edgeHoverFont||g.p.edgeFont);h=d.measureText(a.label).width;switch(g.p.defaultEdgeType){case "curve":f=sigma.tools.pointOnQuadraticCurve(0.5,l,f,k,m,(l+k)/2+(m-f)/4,(f+m)/2+(l-k)/4);l=f.x;f=f.y;break;default:l=(l+k)/2,f=(f+m)/2}"none"!=g.p.edgeHoverLabelBGColor&&(d.fillStyle="edge"==g.p.edgeHoverLabelBGColor?a.color||g.p.defaultEdgeHoverColor:a.bgcolor||g.p.defaultEdgeHoverLabelBGColor,d.fillRect(Math.round(l-h/2),Math.round(f-b/2),h,b));d.fillStyle="edge"==g.p.edgeHoverLabelColor?
a.color||g.p.defaultEdgeHoverColor:a.fontcolor||g.p.defaultEdgeHoverLabelColor;d.fillText(a.label,Math.round(l-h/2),Math.round(f+b/2))}g.p.hoverSourceOnEdgeHover&&(a.source.hover=!0);g.p.hoverTargetOnEdgeHover&&(a.target.hover=!0);return g}}function s(a){if(isNaN(a.x)||isNaN(a.y))throw Error("A node's coordinate is not a number (id: "+a.id+")");return!a.hidden&&a.displayX+a.displaySize>-v/3&&a.displayX-a.displaySize<4*v/3&&a.displayY+a.displaySize>-y/3&&a.displayY-a.displaySize<4*y/3}function z(a,
b){return b==a||"both"==b||!b&&(g.p.defaultEdgeArrow==a||"both"==g.p.defaultEdgeArrow)}function x(a,b,d,c,f,g,h){var m=b[0]-c,l=b[1]-f;d/=Math.sqrt(m*m+l*l);b[0]-=m*d;b[1]-=l*d;a.lineWidth=0;a.fillStyle=a.strokeStyle;sigma.tools.drawArrowhead(a,b[0],b[1],g,sigma.tools.getIncidenceAngle(c,f,b[0],b[1],h));return b}function E(a,b,d,c,f){a=a.displaySize||1;b=Math.atan2((b[1]+d[1])/2-f,(b[0]+d[0])/2-c);return{x:c-Math.cos(b)*a,y:f-Math.sin(b)*a}}sigma.classes.Cascade.call(this);var g=this;this.p={directed:!1,
labelColor:"default",defaultLabelColor:"#000",labelHoverBGColor:"default",defaultHoverLabelBGColor:"#fff",labelHoverShadow:!0,labelHoverShadowColor:"#000",labelHoverColor:"default",defaultLabelHoverColor:"#000",labelActiveBGColor:"default",defaultActiveLabelBGColor:"#fff",labelActiveShadow:!0,labelActiveShadowColor:"#000",labelActiveColor:"default",defaultLabelActiveColor:"#000",labelSize:"fixed",defaultLabelSize:12,labelSizeRatio:2,labelThreshold:6,labelPosition:"",font:"Arial",hoverFont:"",activeFont:"",
fontStyle:"",hoverFontStyle:"",activeFontStyle:"",glyphVisible:"visible",glyphColor:"default",defaultGlyphColor:"red",defaultGlyphFontColor:"#fff",defaultGlyphSizeRatio:0.5,defaultGlyphFontSizeRatio:0.2,edgeLabelSize:"fixed",defaultEdgeLabelSize:12,edgeLabelSizeRatio:1,edgeLabelThreshold:6,defaultEdgeLabelColor:"#000",defaultEdgeLabelBGColor:"rgba(255,255,255,0.7)",defaultEdgeHoverLabelColor:"#000",defaultEdgeHoverLabelBGColor:"rgba(255,255,255,0.7)",edgeLabelColor:"default",edgeLabelBGColor:"default",
edgeHoverLabelColor:"default",edgeHoverLabelBGColor:"edge",edgeFont:"Arial",edgeHoverFont:"",edgeActiveFont:"",edgeFontStyle:"",edgeHoverFontStyle:"",edgeActiveFontStyle:"",edgeColor:"source",defaultEdgeColor:"#aaa",defaultEdgeType:"line",edgeHoverSizeRatio:1,edgeHoverColor:"default",defaultEdgeHoverColor:"#aaa",hoverSourceOnEdgeHover:!1,hoverTargetOnEdgeHover:!1,defaultNodeColor:"#aaa",nodeHoverColor:"node",defaultNodeHoverColor:"#fff",nodeActiveColor:"node",defaultNodeActiveColor:"#fff",borderSize:0,
nodeBorderColor:"node",defaultNodeBorderColor:"#fff",edgesSpeed:200,nodesSpeed:200,labelsSpeed:200,edgeLabelsSpeed:200};var v=k,y=p;this.currentEdgeLabelIndex=this.currentLabelIndex=this.currentNodeIndex=this.currentEdgeIndex=0;this.drawActiveNodeGlyphBorder=this.drawActiveNodeGlyph=this.drawHoverNodeGlyphBorder=this.drawHoverNodeGlyph=this.drawNodeGlyph=this.drawActiveNodeShape=this.drawActiveNodeBorder=this.drawHoverNodeShape=this.drawHoverNodeBorder=this.drawNodeShape=n;this.task_drawLabel=function(){for(var b=
a.nodes.length,d=0;d++<g.p.labelsSpeed&&g.currentLabelIndex<b;)if(g.isOnScreen(a.nodes[g.currentLabelIndex])){var c=a.nodes[g.currentLabelIndex++],h=f;if(c.displaySize>=g.p.labelThreshold||c.forceLabel){var m="fixed"==g.p.labelSize?g.p.defaultLabelSize:g.p.labelSizeRatio*c.displaySize;h.font=g.p.fontStyle+" "+m+"px "+g.p.font;textWidth=h.measureText(c.label).width;h.fillStyle="node"==g.p.labelColor?c.color||g.p.defaultNodeColor:c.fontcolor||g.p.defaultLabelColor;var l=void 0,k=void 0;switch(g.p.labelPosition){case "top":l=
Math.round(c.displayX-textWidth/2);k=Math.round(c.displayY-1.5*c.displaySize);break;case "bottom":l=Math.round(c.displayX-textWidth/2);k=Math.round(c.displayY+1.5*c.displaySize+m);break;case "left":l=Math.round(c.displayX-1.5*c.displaySize-textWidth);k=Math.round(c.displayY+m/2);break;case "center":l=Math.round(c.displayX-textWidth/2);k=Math.round(c.displayY+m/2);break;default:l=Math.round(c.displayX+1.5*c.displaySize),k=Math.round(c.displayY+m/2-3)}h.fillText(c.label,l,k)}}else g.currentLabelIndex++;
return g.currentLabelIndex<b};this.task_drawEdgeLabel=function(){for(var b=a.edges.length,c,f,h=0;h++<g.p.edgeLabelsSpeed&&g.currentEdgeLabelIndex<b;)if(e=a.edges[g.currentEdgeLabelIndex],c=e.source,f=e.target,e.hidden||!g.isOnScreen(c)&&!g.isOnScreen(f))g.currentEdgeLabelIndex++;else if(c=a.edges[g.currentEdgeLabelIndex++],c.source!=c.target&&(void 0!=c.label&&c.label.length)&&(f="fixed"==g.p.edgeLabelSize?g.p.defaultEdgeLabelSize:g.p.edgeLabelSizeRatio*c.displaySize,f>=2.3*g.p.edgeLabelThreshold||
c.forceLabel)){var m=d,l=c.source.displayX,k=c.source.displayY,q=c.target.displayX,p=c.target.displayY,r=void 0,n=void 0,w=void 0;m.font=g.p.edgeFontStyle+" "+f+"px "+g.p.edgeFont;w=m.measureText(c.label).width;switch(g.p.defaultEdgeType){case "curve":l=sigma.tools.pointOnQuadraticCurve(0.5,l,k,q,p,(l+q)/2+(p-k)/4,(k+p)/2+(l-q)/4);r=l.x;n=l.y;break;default:r=(l+q)/2,n=(k+p)/2}m.strokeStyle="edge"==g.p.edgeLabelBGColor?c.color||g.p.defaultEdgeHoverColor:c.bgcolor||g.p.defaultEdgeLabelBGColor;m.strokeText(c.label,
Math.round(r-w/2),Math.round(n+f/2));m.fillStyle="edge"==g.p.edgeLabelColor?c.color||g.p.defaultEdgeColor:c.fontcolor||g.p.defaultEdgeLabelColor;m.fillText(c.label,Math.round(r-w/2),Math.round(n+f/2))}return g.currentEdgeLabelIndex<b};this.task_drawEdge=function(){for(var b=a.edges.length,c,d,f=0;f++<g.p.edgesSpeed&&g.currentEdgeIndex<b;)if(e=a.edges[g.currentEdgeIndex],c=e.source,d=e.target,e.hidden||c.hidden||d.hidden||!g.isOnScreen(c)&&!g.isOnScreen(d))g.currentEdgeIndex++;else{c=a.edges[g.currentEdgeIndex++];
d=[c.source.displayX,c.source.displayY];var m=[c.target.displayX,c.target.displayY],l=c.color;if(!l)switch(g.p.edgeColor){case "source":l=c.source.color||g.p.defaultNodeColor;break;case "target":l=c.target.color||g.p.defaultNodeColor;break;default:l=g.p.defaultEdgeColor}var k=h;switch(c.type||g.p.defaultEdgeType){case "curve":k.strokeStyle=l;var l=(d[0]+m[0])/2+(m[1]-d[1])/4,p=(d[1]+m[1])/2+(d[0]-m[0])/4;z("source",c.arrow)&&(d=x(k,d,c.source.displaySize,l,p,c.arrowDisplaySize,!0));if(g.p.directed||
z("target",c.arrow))m=x(k,m,c.target.displaySize,l,p,c.arrowDisplaySize,!0);var r=E(c,d,m,l,p);k.beginPath();k.moveTo(d[0],d[1]);k.quadraticCurveTo(l,p,m[0],m[1]);k.quadraticCurveTo(r.x,r.y,d[0],d[1]);k.fill();break;default:k.strokeStyle=l;k.lineCap="round";z("source",c.arrow)&&(d=x(k,d,c.source.displaySize,m[0],m[1],c.arrowDisplaySize));if(g.p.directed||z("target",c.arrow))m=x(k,m,c.target.displaySize,d[0],d[1],c.arrowDisplaySize);k.lineWidth=c.displaySize/3;k.beginPath();k.moveTo(d[0],d[1]);k.lineTo(m[0],
m[1]);k.stroke()}c.hover&&q(c)}return g.currentEdgeIndex<b};this.task_drawNode=function(){for(var c=a.nodes.length,d=0;d++<g.p.nodesSpeed&&g.currentNodeIndex<c;)if(g.isOnScreen(a.nodes[g.currentNodeIndex])){var f=a.nodes[g.currentNodeIndex++],h=Math.round(10*f.displaySize)/10,l=b;g.drawNodeShape(l,f.color,f.displayX,f.displayY,h,f);if(f.glyph&&"visible"===g.p.glyphVisible&&!f.glyph.onhover){var k="left"===f.glyph.x?f.displayX-h/1.5:f.displayX+h/1.5,q="bottom"===f.glyph.y?f.displayY+h/1.5:f.displayY-
h/1.5;g.drawNodeGlyph(l,"node"===g.p.glyphColor?f.color:f.glyph.color||g.p.defaultGlyphColor,k,q,h*g.p.defaultGlyphSizeRatio,f.glyph);h=g.p.labelSizeRatio*f.displaySize*g.p.defaultGlyphFontSizeRatio;f.glyph.text&&u(l,k,q,h,f.glyph)}f.hover&&m(f)}else g.currentNodeIndex++;return g.currentNodeIndex<c};this.drawActiveNode=function(a){var b=l;if(!s(a))return g;var c="fixed"==g.p.labelSize?g.p.defaultLabelSize:g.p.labelSizeRatio*a.displaySize;b.font=(g.p.activeFontStyle||g.p.fontStyle||"")+" "+c+"px "+
(g.p.activeFont||g.p.font||"");b.fillStyle="node"==g.p.labelHoverBGColor?a.color||g.p.defaultNodeColor:a.bgcolor||g.p.defaultActiveLabelBGColor;b.beginPath();g.p.labelActiveShadow&&(b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=4,b.shadowColor=g.p.labelActiveShadowColor);textWidth=b.measureText(a.label).width;var d,f,h,m="left";switch(g.p.labelPosition){case "top":h=Math.round(textWidth+1.5*a.displaySize);d=Math.round(a.displayX-h/2);f=Math.round(a.displayY-1.5*a.displaySize-c);m=["left","right"];
break;case "bottom":h=Math.round(textWidth+1.5*a.displaySize);d=Math.round(a.displayX-h/2);f=Math.round(a.displayY+1.5*a.displaySize);m=["left","right"];break;case "left":d=Math.round(a.displayX-1.5*a.displaySize-textWidth-2);f=Math.round(a.displayY-c/2-2);m="right";h=Math.round(textWidth+1.5*a.displaySize+c/2+4);break;case "center":h=Math.round(textWidth+c/2);d=Math.round(a.displayX-h/2);f=Math.round(a.displayY-c/2);m=["left","right"];break;default:d=Math.round(a.displayX-c/2-2),f=Math.round(a.displayY-
c/2-2),h=Math.round(textWidth+1.5*a.displaySize+c/2+4)}sigma.tools.drawRoundRect(b,d,f,h,Math.round(c+4),Math.round(c/2+2),m);b.closePath();b.fill();b.shadowOffsetX=0;b.shadowOffsetY=0;b.shadowBlur=0;h="node"==g.p.nodeBorderColor?a.color||g.p.defaultNodeColor:g.p.defaultNodeBorderColor;g.drawActiveNodeBorder(b,h,Math.round(a.displayX),Math.round(a.displayY),a.displaySize+g.p.borderSize,a);var k="node"==g.p.nodeActiveColor?a.color||g.p.defaultNodeColor:g.p.defaultNodeActiveColor;g.drawActiveNodeShape(b,
k,Math.round(a.displayX),Math.round(a.displayY),a.displaySize,a);if(a.glyph){m=a.displaySize+g.p.borderSize;d="left"===a.glyph.x?a.displayX-m/1.5:a.displayX+m/1.5;f="bottom"===a.glyph.y?a.displayY+m/1.5:a.displayY-m/1.5;var q=m*g.p.defaultGlyphSizeRatio,k="node"===g.p.glyphColor?k:a.glyph.color||g.p.defaultGlyphColor;g.drawActiveNodeGlyphBorder(b,h,d,f,m*(g.p.defaultGlyphSizeRatio+0.1*g.p.defaultGlyphSizeRatio),a.glyph);g.drawActiveNodeGlyph(b,k,d,f,q,a.glyph);h=g.p.labelSizeRatio*a.displaySize*g.p.defaultGlyphFontSizeRatio;
a.glyph.text&&u(b,d,f,h,a.glyph)}b.fillStyle="node"==g.p.labelActiveColor?a.color||g.p.defaultNodeColor:a.fontcolor||g.p.defaultLabelActiveColor;switch(g.p.labelPosition){case "top":d=Math.round(a.displayX-textWidth/2);f=Math.round(a.displayY-1.5*a.displaySize);break;case "bottom":d=Math.round(a.displayX-textWidth/2);f=Math.round(a.displayY+1.5*a.displaySize+c);break;case "left":d=Math.round(a.displayX-1.5*a.displaySize-textWidth);f=Math.round(a.displayY+c/2);break;case "center":d=Math.round(a.displayX-
textWidth/2);f=Math.round(a.displayY+c/2);break;default:d=Math.round(a.displayX+1.5*a.displaySize),f=Math.round(a.displayY+c/2-3)}b.fillText(a.label,d,f);return g};this.drawHoverNode=m;this.drawHoverEdge=q;this.isOnScreen=s;this.resize=function(a,b){v=a;y=b;return g}}function s(b,h){function f(){sigma.chronos.removeTask("node_"+a.id,2).removeTask("edge_"+a.id,2).removeTask("label_"+a.id,2).stopTasks();return a}function d(b,c){a.domElements[b]=document.createElement(c);a.domElements[b].style.position=
"absolute";a.domElements[b].setAttribute("id","sigma_"+b+"_"+a.id);a.domElements[b].setAttribute("class","sigma_"+b+"_"+c);a.domElements[b].setAttribute("width",a.width+"px");a.domElements[b].setAttribute("height",a.height+"px");a.domRoot.appendChild(a.domElements[b]);return a}function l(){a.p.drawHoverNodes&&a.graph.checkHover(a.mousecaptor.mouseX,a.mousecaptor.mouseY);a.p.drawHoverEdges&&(a.graph.checkHoverEdge(a.mousecaptor.mouseX,a.mousecaptor.mouseY,a.mousecaptor.ratio,a.plotter.p.defaultEdgeType),
a.graph.edges.forEach(function(b){b.hover&&!b.active&&a.plotter.drawHoverEdge(b)}));a.p.drawHoverNodes&&a.graph.nodes.forEach(function(b){b.hover&&!b.active&&a.plotter.drawHoverNode(b)});return a}function c(){a.p.drawActiveNodes&&a.graph.nodes.forEach(function(b){b.active&&a.plotter.drawActiveNode(b)});return a}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var a=this,w,r,s;this.id=h.toString();this.p={auto:!0,drawNodes:2,drawEdges:1,drawLabels:2,drawEdgeLabels:2,lastNodes:2,
lastEdges:0,lastLabels:2,lastEdgeLabels:2,drawHoverNodes:!0,drawActiveNodes:!0,drawHoverEdges:!1};this.domRoot=b;this.width=this.domRoot.offsetWidth;this.height=this.domRoot.offsetHeight;this.graph=new p;this.domElements={};d("edges","canvas");d("edgehover","canvas");d("edgelabels","canvas");d("nodes","canvas");d("labels","canvas");d("hover","canvas");d("monitor","div");d("mouse","canvas");this.plotter=new n(this.domElements.nodes.getContext("2d"),this.domElements.edges.getContext("2d"),this.domElements.labels.getContext("2d"),
this.domElements.edgelabels.getContext("2d"),this.domElements.hover.getContext("2d"),this.domElements.edgehover.getContext("2d"),this.graph,this.width,this.height);this.monitor=new v(this,this.domElements.monitor);this.mousecaptor=new k(this.domElements.mouse,this.id);this.mousecaptor.bind("drag interpolate",function(b){a.draw(a.p.auto?2:a.p.drawNodes,a.p.auto?0:a.p.drawEdges,a.p.auto?2:a.p.drawLabels,a.p.auto?0:a.p.drawEdgeLabels,!0)}).bind("stopdrag stopinterpolate",function(b){a.draw(a.p.auto?
2:a.p.drawNodes,a.p.auto?1:a.p.drawEdges,a.p.auto?2:a.p.drawLabels,a.p.auto?1:a.p.drawEdgeLabels,!0)}).bind("mousedown mouseup ctrlclick",function(b){w="mousedown"==b.type?"downgraph":"upgraph";a.dispatch(w);r=a.graph.nodes.filter(function(a){return!!a.hover}).map(function(a){return a.id});r.length?("ctrlclick"==b.type?w="ctrlclicknodes":"mousedown"==b.type?w="downnodes":(w="upnodes",a.draw(a.p.auto?-1:a.p.drawNodes,a.p.auto?1:a.p.drawEdges,a.p.auto?-1:a.p.drawLabels,a.p.auto?1:a.p.drawEdgeLabels)),
a.dispatch(w,r)):(r=a.graph.edges.filter(function(a){return!!a.hover}).map(function(a){return a.id}),r.length&&(w="upedges","ctrlclick"==b.type?w="ctrlclickedges":"mousedown"==b.type&&(w="downedges"),a.dispatch(w,r)))}).bind("rightclick dblclick",function(b){r=a.graph.nodes.filter(function(a){return!!a.hover}).map(function(a){return a.id});r.length?(w="dblclick"==b.type?"dblclicknodes":"rightclicknodes",a.dispatch(w,r)):(r=a.graph.edges.filter(function(a){return!!a.hover}).map(function(a){return a.id}),
r.length?(w="dblclick"==b.type?"dblclickedges":"rightclickedges",a.dispatch(w,r)):(w="dblclick"==b.type?"dblclickgraph":"rightclickgraph",a.dispatch(w)))}).bind("move",function(b){"downgraph"==w||"downedges"==w?(a.mousecaptor.drag(),a.refresh()):"downnodes"==w?(a.graph.translateNodes(r,b.content.dX,b.content.dY,b.content.stageX,b.content.stageY,b.content.ratio),a.domElements.hover.getContext("2d").clearRect(0,0,a.domElements.hover.width,a.domElements.hover.height),a.draw(a.p.auto?2:a.p.drawNodes,
a.p.auto?2:a.p.drawEdges,a.p.auto?2:a.p.drawLabels,a.p.auto?0:a.p.drawEdgeLabels)):a.refresh()});sigma.chronos.bind("startgenerators",function(){sigma.chronos.getGeneratorsIDs().some(function(b){return!!b.match(RegExp("_ext_"+a.id+"$",""))})&&(void 0===s&&(s=a.p.drawHoverEdges,a.p.drawHoverEdges=!1),a.draw(a.p.auto?2:a.p.drawNodes,a.p.auto?0:a.p.drawEdges,a.p.auto?2:a.p.drawLabels,a.p.auto?0:a.p.drawEdgeLabels))}).bind("stopgenerators",function(){a.p.drawHoverEdges=s;s=void 0;a.draw()});for(var u=
0;u<F.plugins.length;u++)F.plugins[u](this);this.draw=function(b,c,d,h,l){if(l&&sigma.chronos.getGeneratorsIDs().some(function(b){return!!b.match(RegExp("_ext_"+a.id+"$",""))}))return a;b=void 0==b?a.p.drawNodes:b;c=void 0==c?a.p.drawEdges:c;l=void 0==d?a.p.drawLabels:d;d=void 0==d?a.p.drawEdgeLabels:h;h={nodes:b,edges:c,labels:l,edgeLabels:d};a.p.lastNodes=b;a.p.lastEdges=c;a.p.lastLabels=l;a.p.lastEdgeLabels=d;f();a.graph.rescale(a.width,a.height,0<b,0<c).setBorders();a.mousecaptor.checkBorders(a.graph.borders,
a.width,a.height);a.graph.translate(a.mousecaptor.stageX,a.mousecaptor.stageY,a.mousecaptor.ratio,0<b,0<c);a.dispatch("graphscaled");for(var k in a.domElements)"canvas"==a.domElements[k].nodeName.toLowerCase()&&(void 0==h[k]||0<=h[k])&&a.domElements[k].getContext("2d").clearRect(0,0,a.domElements[k].width,a.domElements[k].height);a.plotter.currentEdgeIndex=0;a.plotter.currentNodeIndex=0;a.plotter.currentLabelIndex=0;a.plotter.currentEdgeLabelIndex=0;k=null;h=!1;if(d)if(1<d)for(;a.plotter.task_drawEdgeLabel(););
else k?sigma.chronos.queueTask(a.plotter.task_drawEdgeLabel,"label_"+a.id,k):sigma.chronos.addTask(a.plotter.task_drawEdgeLabel,"label_"+a.id,!1),h=!0,k="label_"+a.id;if(b)if(1<b)for(;a.plotter.task_drawNode(););else sigma.chronos.addTask(a.plotter.task_drawNode,"node_"+a.id,!1),h=!0,k="node_"+a.id;if(l)if(1<l)for(;a.plotter.task_drawLabel(););else k?sigma.chronos.queueTask(a.plotter.task_drawLabel,"label_"+a.id,k):sigma.chronos.addTask(a.plotter.task_drawLabel,"label_"+a.id,!1),h=!0,k="label_"+a.id;
if(c)if(1<c)for(;a.plotter.task_drawEdge(););else k?sigma.chronos.queueTask(a.plotter.task_drawEdge,"edge_"+a.id,k):sigma.chronos.addTask(a.plotter.task_drawEdge,"edge_"+a.id,!1),h=!0,k="edge_"+a.id;a.dispatch("draw");a.refresh();h&&sigma.chronos.runTasks();return a};this.resize=function(b,c){var d=a.width,f=a.height;void 0!=b&&void 0!=c?(a.width=b,a.height=c):(a.width=a.domRoot.offsetWidth,a.height=a.domRoot.offsetHeight);if(d!=a.width||f!=a.height){for(var h in a.domElements)a.domElements[h].setAttribute("width",
a.width+"px"),a.domElements[h].setAttribute("height",a.height+"px");a.plotter.resize(a.width,a.height);a.draw(a.p.lastNodes,a.p.lastEdges,a.p.lastLabels,a.p.lastEdgeLabels,!0)}return a};this.refresh=function(){a.domElements.hover.getContext("2d").clearRect(0,0,a.domElements.hover.width,a.domElements.hover.height);a.domElements.edgehover.getContext("2d").clearRect(0,0,a.domElements.edgehover.width,a.domElements.edgehover.height);l();c();return a};this.drawHover=l;this.drawActive=c;this.clearSchedule=
f;window.addEventListener("resize",function(){a.resize()})}function B(b){var h=this;sigma.classes.EventDispatcher.call(this);this._core=b;this.kill=function(){};this.getID=function(){return b.id};this.configProperties=function(f,d){var l=b.config(f,d);return l==b?h:l};this.drawingProperties=function(f,d){var l=b.plotter.config(f,d);return l==b.plotter?h:l};this.mouseProperties=function(f,d){var l=b.mousecaptor.config(f,d);return l==b.mousecaptor?h:l};this.graphProperties=function(f,d){var l=b.graph.config(f,
d);return l==b.graph?h:l};this.getMouse=function(){return{mouseX:b.mousecaptor.mouseX,mouseY:b.mousecaptor.mouseY,down:b.mousecaptor.isMouseDown}};this.position=function(f,d,l){if(0==arguments.length)return{stageX:b.mousecaptor.stageX,stageY:b.mousecaptor.stageY,ratio:b.mousecaptor.ratio};b.mousecaptor.stageX=void 0!=f?f:b.mousecaptor.stageX;b.mousecaptor.stageY=void 0!=d?d:b.mousecaptor.stageY;b.mousecaptor.ratio=void 0!=l?l:b.mousecaptor.ratio;return h};this.goTo=function(f,d,l){b.mousecaptor.interpolate(f,
d,l);return h};this.zoomTo=function(f,d,l){l=Math.min(Math.max(b.mousecaptor.config("minRatio"),l),b.mousecaptor.config("maxRatio"));l==b.mousecaptor.ratio?b.mousecaptor.interpolate(f-b.width/2+b.mousecaptor.stageX,d-b.height/2+b.mousecaptor.stageY):b.mousecaptor.interpolate((l*f-b.mousecaptor.ratio*b.width/2)/(l-b.mousecaptor.ratio),(l*d-b.mousecaptor.ratio*b.height/2)/(l-b.mousecaptor.ratio),l);return h};this.resize=function(f,d){b.resize(f,d);return h};this.draw=function(f,d,l,c,a){b.draw(f,d,
l,c,a);return h};this.refresh=function(){b.refresh();return h};this.addGenerator=function(f,d,l){sigma.chronos.addGenerator(f+"_ext_"+b.id,d,l);return h};this.removeGenerator=function(f){sigma.chronos.removeGenerator(f+"_ext_"+b.id);return h};this.addNode=function(f,d){b.graph.addNode(f,d);return h};this.addEdge=function(f,d,l,c){b.graph.addEdge(f,d,l,c);return h};this.dropNode=function(f){b.graph.dropNode(f);return h};this.dropEdge=function(f){b.graph.dropEdge(f);return h};this.pushGraph=function(f,
d){f.nodes&&f.nodes.forEach(function(f){!f.id||d&&b.graph.nodesIndex[f.id]||h.addNode(f.id,f)});f.edges&&f.edges.forEach(function(f){validID=f.source&&f.target&&f.id;!validID||d&&b.graph.edgesIndex[f.id]||h.addEdge(f.id,f.source,f.target,f)});return h};this.emptyGraph=function(){b.graph.empty();return h};this.getNodesCount=function(){return b.graph.nodes.length};this.getEdgesCount=function(){return b.graph.edges.length};this.iterNodes=function(f,d){b.graph.iterNodes(f,d);return h};this.iterEdges=
function(f,d){b.graph.iterEdges(f,d);return h};this.getNodes=function(f){return b.graph.getNodes(f)};this.getEdges=function(f){return b.graph.getEdges(f)};this.activateMonitoring=function(){return b.monitor.activate()};this.desactivateMonitoring=function(){return b.monitor.desactivate()};b.bind("downnodes upnodes downedges upedges downgraph upgraph rightclickgraph dblclickgraph ctrlclicknodes rightclicknodes dblclicknodes ctrlclickedges rightclickedges dblclickedges",function(b){h.dispatch(b.type,
b.content)});b.mousecaptor.bind("drag",function(b){h.dispatch(b.type,b.content)});b.graph.bind("overnodes outnodes overedges outedges",function(b){h.dispatch(b.type,b.content)})}var y=0,F={plugins:[]};sigma.init=function(b){b=new s(b,(++y).toString());sigma.instances[y]=new B(b);return sigma.instances[y]};sigma.addPlugin=function(b,h,f){B.prototype[b]=h;F.plugins.push(f)};sigma.chronos=new function(){function b(a){window.setTimeout(a,0);return n}function h(){for(n.dispatch("frameinserted");u&&A.length&&
f(););u&&A.length?(B=(new Date).getTime(),s++,F=y-v,x=v-F,n.dispatch("insertframe"),b(h)):k()}function f(){D%=A.length;if(!A[D].task()){var a=A[D].taskName;C=C.filter(function(b){b.taskParent==a&&A.push({taskName:b.taskName,task:b.task});return b.taskParent!=a});n.dispatch("killed",A.splice(D--,1)[0])}D++;y=(new Date).getTime()-B;return y<=x}function d(){u=!0;s=D=0;g=B=(new Date).getTime();n.dispatch("start");n.dispatch("insertframe");b(h);return n}function k(){n.dispatch("stop");u=!1;return n}function c(a,
b,c){if("function"!=typeof a)throw Error('Task "'+b+'" is not a function');A.push({taskName:b,task:a});u=!!(u||c&&d()||1);return n}function a(a){return a?Object.keys(t).filter(function(a){return!!t[a].on}).length:Object.keys(t).length}function p(){Object.keys(t).length?(n.dispatch("startgenerators"),n.unbind("killed",r),b(function(){for(var a in t)t[a].on=!0,c(t[a].task,a,!1)}),n.bind("killed",r).runTasks()):n.dispatch("stopgenerators");return n}function r(b){void 0!=t[b.content.taskName]&&(t[b.content.taskName].del||
!t[b.content.taskName].condition()?delete t[b.content.taskName]:t[b.content.taskName].on=!1,0==a(!0)&&p())}sigma.classes.EventDispatcher.call(this);var n=this,u=!1,m=80,q=0,s=0,v=1E3/m,x=v,y=0,g=0,B=0,F=0,t={},A=[],C=[],D=0;this.frequency=function(a){return void 0!=a?(m=Math.abs(1*a),v=1E3/m,s=0,n):m};this.runTasks=d;this.stopTasks=k;this.insertFrame=b;this.addTask=c;this.queueTask=function(a,b,c){if("function"!=typeof a)throw Error('Task "'+b+'" is not a function');if(!A.concat(C).some(function(a){return a.taskName==
c}))throw Error('Parent task "'+c+'" of "'+b+'" is not attached.');C.push({taskParent:c,taskName:b,task:a});return n};this.removeTask=function(a,b){if(void 0==a)A=[],1==b?C=[]:2==b&&(A=C,C=[]),k();else{var c="string"==typeof a?a:"";A=A.filter(function(b){return("string"==typeof a?b.taskName==a:b.task==a)?(c=b.taskName,!1):!0});0<b&&(C=C.filter(function(a){1==b&&a.taskParent==c&&A.push(a);return a.taskParent!=c}))}u=!!(!A.length||k()&&0);return n};this.addGenerator=function(b,c,d){if(void 0!=t[b])return n;
t[b]={task:c,condition:d};0==a(!0)&&p();return n};this.removeGenerator=function(a){t[a]&&(t[a].on=!1,t[a].del=!0);return n};this.startGenerators=p;this.getGeneratorsIDs=function(){return Object.keys(t)};this.getFPS=function(){u&&(q=Math.round(1E4*(s/((new Date).getTime()-g)))/10);return q};this.getTasksCount=function(){return A.length};this.getQueuedTasksCount=function(){return C.length};this.getExecutionTime=function(){return B-g};return this};sigma.debugMode=0;sigma.log=function(){if(1==sigma.debugMode)for(var b in arguments)console.log(arguments[b]);
else if(1<sigma.debugMode)for(b in arguments)throw Error(arguments[b]);return sigma};sigma.easing={linear:{},quadratic:{}};sigma.easing.linear.easenone=function(b){return b};sigma.easing.quadratic.easein=function(b){return b*b};sigma.easing.quadratic.easeout=function(b){return-b*(b-2)};sigma.easing.quadratic.easeinout=function(b){return 1>(b*=2)?0.5*b*b:-0.5*(--b*(b-2)-1)};sigma.tools.drawRoundRect=function(b,h,f,d,k,c,a){c=c?c:0;var n=a?a:[],n="string"==typeof n?n.split(" "):n;a=c&&(0<=n.indexOf("topleft")||
0<=n.indexOf("top")||0<=n.indexOf("left"));var p=c&&(0<=n.indexOf("topright")||0<=n.indexOf("top")||0<=n.indexOf("right")),s=c&&(0<=n.indexOf("bottomleft")||0<=n.indexOf("bottom")||0<=n.indexOf("left")),n=c&&(0<=n.indexOf("bottomright")||0<=n.indexOf("bottom")||0<=n.indexOf("right"));b.moveTo(h,f+c);a?b.arcTo(h,f,h+c,f,c):b.lineTo(h,f);p?(b.lineTo(h+d-c,f),b.arcTo(h+d,f,h+d,f+c,c)):b.lineTo(h+d,f);n?(b.lineTo(h+d,f+k-c),b.arcTo(h+d,f+k,h+d-c,f+k,c)):b.lineTo(h+d,f+k);s?(b.lineTo(h+c,f+k),b.arcTo(h,
f+k,h,f+k-c,c)):b.lineTo(h,f+k);b.lineTo(h,f+c)};sigma.tools.drawArrowhead=function(b,h,f,d,k){b.beginPath();b.moveTo(h,f);var c=h+Math.cos(0.017453292519943295*(22+k))*d,a=f+Math.sin(0.017453292519943295*(22+k))*d,n=h+Math.cos(0.017453292519943295*(k-22))*d;d=f+Math.sin(0.017453292519943295*(k-22))*d;b.lineTo(c,a);b.quadraticCurveTo((h+c+n)/3,(f+a+d)/3,n,d);b.lineTo(h,f);b.fill()};sigma.tools.getIncidenceAngle=function(b,h,f,d,k){return(b<=f?180:0)+180*Math.atan((d-h)/(f-b))/Math.PI};sigma.tools.getRGB=
function(b,h){b=b.toString();var f={r:0,g:0,b:0};if(3<=b.length&&"#"==b.charAt(0)){var d=b.length-1;6==d?f={r:parseInt(b.charAt(1)+b.charAt(2),16),g:parseInt(b.charAt(3)+b.charAt(4),16),b:parseInt(b.charAt(5)+b.charAt(5),16)}:3==d&&(f={r:parseInt(b.charAt(1)+b.charAt(1),16),g:parseInt(b.charAt(2)+b.charAt(2),16),b:parseInt(b.charAt(3)+b.charAt(3),16)})}h&&(f=[f.r,f.g,f.b]);return f};sigma.tools.rgbToHex=function(b,h,f){return sigma.tools.toHex(b)+sigma.tools.toHex(h)+sigma.tools.toHex(f)};sigma.tools.toHex=
function(b){b=parseInt(b,10);if(isNaN(b))return"00";b=Math.max(0,Math.min(b,255));return"0123456789ABCDEF".charAt((b-b%16)/16)+"0123456789ABCDEF".charAt(b%16)};sigma.tools.isOnSegment=function(b,h,f,d,k,c,a,n){return Math.min(f,k)<b&&b<Math.max(f,k)&&Math.min(d,c)<h&&h<Math.max(d,c)?Math.abs((h-d)*(k-f)-(b-f)*(c-d))<a*n:!1};sigma.tools.pointOnQuadraticCurve=function(b,h,f,d,k,c,a){return{x:Math.pow(1-b,2)*h+2*(1-b)*b*c+Math.pow(b,2)*d,y:Math.pow(1-b,2)*f+2*(1-b)*b*a+Math.pow(b,2)*k}};sigma.tools.isOnQuadraticCurve=
function(b,h,f,d,k,c,a,n,p,s){var u=Math.sqrt(Math.pow(f-k,2)+Math.pow(d-c,2));if(Math.abs(b-f)>u||Math.abs(h-d)>u)return!1;var m=Math.sqrt(Math.pow(f-b,2)+Math.pow(d-h,2)),q=Math.sqrt(Math.pow(k-b,2)+Math.pow(c-h,2)),u=0.5,m=m<q?-0.1:0.1;s=Math.log(1+p)*s/20;q=sigma.tools.pointOnQuadraticCurve(u,f,d,k,c,a,n);for(q=Math.sqrt(Math.pow(b-q.x,2)+Math.pow(h-q.y,2));0<=u&&1>=u&&q>s&&(0.025<m||-0.025>m);)p=q,q=sigma.tools.pointOnQuadraticCurve(u,f,d,k,c,a,n),q=Math.sqrt(Math.pow(b-q.x,2)+Math.pow(h-q.y,
2)),q>p?(m=-m/2,u+=m):0>u+m||1<u+m?(m/=2,q=p):u+=m;return q<s};sigma.publicPrototype=B.prototype})();
